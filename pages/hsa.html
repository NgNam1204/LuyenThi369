<!DOCTYPE html>
<html lang="vi" data-theme="dark">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>PhÃ²ng luyá»‡n HSA â€“ LuyenThi369</title>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>

*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#080b10;--bg2:#0d1017;--surface:#161c28;--border:#1e2840;
  --accent:#00e5ff;--accent2:#7c3aed;--accent3:#f59e0b;
  --green:#10b981;--red:#ef4444;
  --text:#e8edf5;--muted:#5a6b88;--card:#111622;
  --shadow:0 4px 24px rgba(0,0,0,.4);
  --radius:14px;
}
[data-theme="light"]{
  --bg:#f5f7ff;--bg2:#ffffff;--surface:#edf0fb;--border:#dce3f5;
  --text:#111827;--muted:#6b7a99;--card:#ffffff;
  --shadow:0 2px 16px rgba(100,120,200,.12);
}
body{background:var(--bg);color:var(--text);font-family:'Be Vietnam Pro',sans-serif;transition:background .3s,color .3s;line-height:1.5}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
/* layout */
.app{display:flex;min-height:100vh}
.sidebar{width:260px;background:var(--bg2);border-right:1px solid var(--border);display:flex;flex-direction:column;position:fixed;height:100vh;overflow-y:auto;z-index:100;transition:background .3s,border-color .3s}
.logo{padding:20px;display:flex;align-items:center;gap:11px;border-bottom:1px solid var(--border);text-decoration:none}
.logo-icon{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:10px;display:grid;place-items:center;font-size:18px;flex-shrink:0;box-shadow:0 0 16px rgba(0,229,255,.3)}
.logo-text{font-size:16px;font-weight:800;color:var(--text)}.logo-text em{font-style:normal;color:var(--accent)}
.nav{flex:1;padding:12px 0}
.nav-sec{margin-bottom:4px}
.nav-lbl{font-size:10px;font-weight:700;letter-spacing:2px;color:var(--muted);padding:8px 20px;text-transform:uppercase;opacity:.7}
.nav-a{display:flex;align-items:center;gap:12px;padding:10px 20px;color:var(--muted);font-size:14px;font-weight:500;transition:.2s;border-left:3px solid transparent;text-decoration:none;border-radius:0}
.nav-a:hover{color:var(--text);background:rgba(128,128,200,.06)}
.nav-a.active{color:var(--accent);background:rgba(0,229,255,.07);border-left-color:var(--accent);font-weight:600}
.nav-a .ic{width:18px;text-align:center;flex-shrink:0;font-size:17px}
.badge{margin-left:auto;background:linear-gradient(135deg,var(--accent2),#6d28d9);color:#fff;font-size:10px;font-weight:700;padding:2px 7px;border-radius:999px}
.sb-foot{padding:14px;border-top:1px solid var(--border)}
.user-card{display:flex;align-items:center;gap:10px;background:var(--surface);padding:10px 12px;border-radius:12px;cursor:pointer;text-decoration:none;transition:.2s;border:1px solid transparent}
.user-card:hover{border-color:var(--accent)}
.av{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--accent2),var(--accent));display:grid;place-items:center;font-size:18px;font-weight:700;flex-shrink:0;color:#fff}
.uname{font-size:14px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:130px}
.uplan{font-size:12px;color:var(--accent3);font-weight:600}
.logout{margin-top:8px;display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;cursor:pointer;color:var(--muted);font-size:14px;font-weight:600;transition:.2s;border:none;background:none;font-family:inherit;width:100%}
.logout:hover{color:var(--red);background:rgba(239,68,68,.06)}
/* main */
.main{margin-left:260px;flex:1;display:flex;flex-direction:column;min-height:100vh;min-width:0;overflow-x:hidden}
.topbar{position:fixed;top:0;left:260px;right:0;z-index:50;background:rgba(8,11,16,.9);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 32px;height:60px;display:flex;align-items:center;justify-content:space-between;transition:background .3s,border-color .3s,left .28s}
[data-theme="light"] .topbar{background:rgba(245,247,255,.92)}
.topbar-l .ttl{font-size:22px;font-weight:800;letter-spacing:-.3px;line-height:1.2}
.topbar-l .tsub{font-size:13px;color:var(--muted);margin-top:1px}
.topbar-r{display:flex;align-items:center;gap:8px}
/* buttons */
.btn{display:inline-flex;align-items:center;gap:7px;padding:8px 18px;border-radius:9px;font-size:14px;font-weight:600;cursor:pointer;border:none;transition:.2s;font-family:inherit;white-space:nowrap}
.btn-p{background:var(--accent);color:#000}.btn-p:hover{background:#00cfeb;transform:translateY(-1px)}
.btn-g{background:var(--surface);color:var(--muted);border:1px solid var(--border)}.btn-g:hover{color:var(--text);border-color:var(--muted)}
.btn-v{background:linear-gradient(135deg,var(--accent2),#6d28d9);color:#fff}.btn-v:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(124,58,237,.4)}
.icon-btn{width:36px;height:36px;border-radius:9px;background:var(--surface);border:1px solid var(--border);display:grid;place-items:center;cursor:pointer;transition:.2s;font-size:16px}
.icon-btn:hover{border-color:var(--accent)}
/* content */
.content{padding:24px 28px;flex:1;min-width:0;overflow-x:hidden;padding-top:84px}
/* cards */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:background .3s,border-color .3s;min-width:0;overflow:hidden}
[data-theme="light"] .card{box-shadow:var(--shadow)}
.card-title{font-size:14px;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px}
/* progress bar */
.pbar{height:6px;background:var(--surface);border-radius:999px;overflow:hidden}
.pbar-fill{height:100%;border-radius:999px;transition:width .5s ease}
/* animation */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.fadein>*{animation:fadeUp .35s ease both}
.fadein>*:nth-child(2){animation-delay:.05s}
.fadein>*:nth-child(3){animation-delay:.1s}
.fadein>*:nth-child(4){animation-delay:.15s}
/* footer */
.site-footer{background:#06090f;border-top:1px solid #1a2030;padding:36px 40px 24px;margin-top:auto;transition:background .3s,border-color .3s}
[data-theme="light"] .site-footer{background:#eef1fb;border-top-color:#c8d4f0}
/* light mode text */
[data-theme="light"] .sf-addr{color:#3a4a6a}
[data-theme="light"] .sf-addr strong{color:#0f1a35}
[data-theme="light"] .sf-member{color:#3a4a6a}
[data-theme="light"] .sf-label{color:#5a6a8a}
[data-theme="light"] .sf-copy,[data-theme="light"] .sf-brand{color:#5a6a8a}
[data-theme="light"] .sf-bottom{border-top-color:#c8d4f0}
[data-theme="light"] .sf-col:first-child,[data-theme="light"] .sf-col:nth-child(2){border-right-color:#c8d4f0}
[data-theme="light"] .sf-map iframe{border-color:#c8d4f0}
[data-theme="light"] .sf-fb a{background:#dce6ff;color:#0f1a35;border-color:#1877f2}
/* layout */
.sf-inner{display:table;width:100%;table-layout:fixed;border-collapse:collapse}
.sf-col{display:table-cell;width:33.333%;vertical-align:top;padding:0 28px;text-align:center}
.sf-col:first-child{padding-left:0;text-align:left;border-right:1px solid #1e2840}
.sf-col:nth-child(2){border-right:1px solid #1e2840}
.sf-col:last-child{padding-right:0}
.sf-label{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:#4a5878;margin-bottom:16px;display:block;text-align:center}
.sf-col:first-child .sf-label{text-align:left}
.sf-addr{font-size:14px;color:#8899bb;line-height:1.9}
.sf-addr strong{color:#c8d4f0;font-weight:700}
.sf-map{margin-top:14px}
.sf-map iframe{border-radius:10px;width:100%;height:150px;border:1px solid #1e2840;display:block}
.sf-members{display:inline-flex;flex-direction:column;gap:10px;align-items:flex-start}
.sf-member{display:flex;align-items:center;gap:9px;font-size:14px;color:#8899bb;white-space:nowrap}
[data-theme="light"] .sf-member{color:#3a4a6a}
.sf-member::before{content:'';width:7px;height:7px;border-radius:50%;background:var(--accent);flex-shrink:0}
.sf-fb{display:flex;justify-content:center;width:100%}
.sf-fb a{display:inline-flex;align-items:center;gap:9px;background:#1a2236;color:#e8edf5;font-size:14px;font-weight:600;padding:10px 22px;border-radius:12px;border:1px solid #1877f2;text-decoration:none;transition:.2s}
[data-theme="light"] .sf-fb a{background:#dce6ff;color:#1a2545;border-color:#1877f2}
.sf-fb a:hover{background:#1877f2;color:#fff}
.sf-bottom{margin-top:24px;padding-top:16px;border-top:1px solid #1a2030;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;transition:border-color .3s}
[data-theme="light"] .sf-bottom{border-top-color:#c8d4f0}
.sf-copy,.sf-brand{font-size:13px;color:#3a4868;transition:color .3s}
[data-theme="light"] .sf-copy,[data-theme="light"] .sf-brand{color:#7a8aaa}

.hsa-hero{background:linear-gradient(135deg,#0a1628,#140a28);border:1px solid #1e2840;border-radius:20px;padding:36px;margin-bottom:24px;text-align:center;position:relative;overflow:hidden}
.hsa-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 0%,rgba(124,58,237,.2),transparent 65%);pointer-events:none}
[data-theme="light"] .hsa-hero{background:linear-gradient(135deg,#e8ecff,#f0e8ff);border-color:#d0d8f8}
.hbadge{display:inline-block;background:var(--accent2);color:#fff;font-size:17px;font-weight:700;padding:4px 14px;border-radius:999px;margin-bottom:14px;position:relative}
.hsa-hero h2{font-size:28px;font-weight:800;margin-bottom:10px;position:relative}
[data-theme="light"] .hsa-hero h2{color:#0f1420}
.hsa-hero p{color:var(--muted);font-size:18px;position:relative;margin-bottom:22px}
.hbtns{display:flex;gap:12px;justify-content:center;position:relative}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.src{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;text-align:center;transition:.2s}
[data-theme="light"] .src{box-shadow:var(--shadow)}
.src:hover{border-color:var(--accent2)}
.srv{font-size:26px;font-weight:800;font-family:'Space Mono';margin-bottom:4px}
.srl{font-size:17px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.parts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px}
.part-c{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px;text-align:center;cursor:pointer;transition:.25s}
[data-theme="light"] .part-c{box-shadow:var(--shadow)}
.part-c:hover{border-color:var(--accent2);transform:translateY(-2px);background:rgba(124,58,237,.04)}
.pc-ic{font-size:30px;margin-bottom:10px}.pc-t{font-size:17px;font-weight:800;margin-bottom:4px}.pc-s{font-size:18px;color:var(--muted);margin-bottom:12px}
.pc-meta{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.chip{font-size:17px;background:var(--surface);color:var(--muted);padding:3px 10px;border-radius:6px;font-weight:600}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:24px}
.lb-item{display:flex;align-items:center;gap:12px;padding:11px 0;border-bottom:1px solid var(--border)}
.lb-item:last-child{border-bottom:none}
.lbr{width:24px;font-size:17px;font-weight:800;font-family:'Space Mono';text-align:center;flex-shrink:0}
.lbn{flex:1;font-size:17px;font-weight:600}.lbs{font-family:'Space Mono';font-size:18px;font-weight:700;color:var(--accent)}
.lbs.me{color:var(--accent3)}
.sched-item{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)}
.sched-item:last-child{border-bottom:none}
.sic{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;font-size:18px;flex-shrink:0}
.stt{font-size:17px;font-weight:700;margin-bottom:2px}.sts{font-size:17px;color:var(--muted)}
.reg-btn{padding:7px 14px;font-size:18px;background:linear-gradient(135deg,var(--accent2),#6d28d9);border:none;border-radius:8px;color:#fff;cursor:pointer;font-weight:700;font-family:inherit;transition:.2s;white-space:nowrap}
.reg-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(124,58,237,.4)}
.reg-btn.done{background:var(--surface);color:var(--green);border:1px solid var(--green)}
.exam-ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(12px);z-index:200;align-items:center;justify-content:center}
.exam-ov.show{display:flex}
.exam-box{background:var(--bg2);border:1px solid var(--border);border-radius:20px;width:820px;max-width:96vw;max-height:90vh;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 32px 80px rgba(0,0,0,.5)}
.exam-hdr{padding:18px 26px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:linear-gradient(135deg,rgba(124,58,237,.1),transparent)}
.exam-title{font-size:18px;font-weight:800}
.exam-timer{font-family:'Space Mono';font-size:18px;font-weight:900;color:var(--accent2);background:rgba(124,58,237,.12);padding:6px 16px;border-radius:10px}
.exam-close{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:var(--surface);cursor:pointer;display:grid;place-items:center;color:var(--muted);transition:.2s}
.exam-close:hover{color:var(--red);border-color:var(--red)}
.exam-body{display:flex;flex:1;overflow:hidden}
.exam-parts{width:200px;background:var(--bg);border-right:1px solid var(--border);overflow-y:auto;padding:14px;flex-shrink:0}
.ep-title{font-size:17px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:10px}
.ep-part{padding:10px 12px;border-radius:8px;cursor:pointer;margin-bottom:4px;transition:.2s;border:1px solid transparent}
.ep-part:hover{background:var(--surface)}
.ep-part.active{background:rgba(124,58,237,.1);border-color:var(--accent2);color:var(--accent2)}
.ep-name{font-size:18px;font-weight:700}.ep-sub{font-size:10px;color:var(--muted);margin-top:2px}
.exam-qs{flex:1;overflow-y:auto;padding:20px 26px}
.exam-q{margin-bottom:24px;padding-bottom:24px;border-bottom:1px solid var(--border)}
.exam-q:last-child{border-bottom:none}
.eq-num{font-size:17px;font-weight:700;color:var(--muted);margin-bottom:8px;text-transform:uppercase;letter-spacing:1.5px}
.eq-text{font-size:18px;font-weight:600;line-height:1.7;margin-bottom:14px}
.eq-opts{display:flex;flex-direction:column;gap:7px}
.eq-opt{display:flex;align-items:center;gap:10px;padding:10px 14px;border:1.5px solid var(--border);border-radius:10px;cursor:pointer;font-size:17px;transition:.2s}
.eq-opt:hover{border-color:var(--accent2)}
.eq-opt.picked{border-color:var(--accent2);background:rgba(124,58,237,.07)}
.eq-lbl{width:24px;height:24px;border-radius:6px;background:var(--surface);display:grid;place-items:center;font-size:17px;font-weight:800;flex-shrink:0;font-family:'Space Mono'}
.eq-opt.picked .eq-lbl{background:var(--accent2);color:#fff}
.exam-foot{padding:14px 26px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}

/* â”€â”€ MOBILE â”€â”€ */
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:98;backdrop-filter:blur(4px);cursor:pointer}
.sidebar-overlay.show{display:block}
.hamburger{width:38px;height:38px;border-radius:9px;background:var(--surface);border:1px solid var(--border);align-items:center;justify-content:center;cursor:pointer;font-size:18px;flex-shrink:0;transition:.2s;margin-right:10px;display:none}
.hamburger:hover{border-color:var(--accent)}
.sidebar-close{display:none;position:absolute;top:16px;right:10px;width:32px;height:32px;border-radius:8px;background:var(--surface);border:1px solid var(--border);align-items:center;justify-content:center;cursor:pointer;font-size:22px;font-weight:700;color:var(--muted);transition:.2s;z-index:10;line-height:1}
.sidebar-close:hover{color:var(--accent);border-color:var(--accent)}
@media(max-width:768px){
  .hamburger{display:flex!important}
  .sidebar-close{display:flex}
  .sidebar{position:fixed;left:0;top:0;height:100vh;transform:translateX(-260px);transition:transform .28s cubic-bezier(.4,0,.2,1);z-index:99;box-shadow:4px 0 24px rgba(0,0,0,.4)}
  .sidebar.open{transform:translateX(0)}
  .main{margin-left:0!important;width:100%}
  .topbar{padding:0 16px;left:0}
  .content{padding:16px}
  .grid-4{grid-template-columns:repeat(2,1fr)!important}
  .grid-2{grid-template-columns:1fr!important}
  .two-col{grid-template-columns:1fr!important}
  .modes{grid-template-columns:repeat(2,1fr)!important}
  .topics{grid-template-columns:repeat(2,1fr)!important}
  .parts-grid{grid-template-columns:1fr!important}
  .stats-row{grid-template-columns:repeat(2,1fr)!important}
  .settings-layout{grid-template-columns:1fr!important}
  .bank-grid{grid-template-columns:1fr!important}
  .qbox{max-height:98vh;border-radius:16px 16px 0 0;position:fixed;bottom:0;left:0;right:0;width:100%!important;max-width:100%!important}
  .qov{align-items:flex-end}
  .exam-box{border-radius:16px 16px 0 0;position:fixed;bottom:0;left:0;right:0;width:100%!important;max-width:100%!important;max-height:95vh}
  .exam-ov{align-items:flex-end}
  .exam-body{flex-direction:column}
  .exam-parts{width:100%!important;height:auto;flex-direction:row;overflow-x:auto;padding:10px;display:flex;gap:8px;border-right:none;border-bottom:1px solid var(--border)}
  .ep-part{flex-shrink:0;padding:8px 12px;margin-bottom:0}
  .prev-box{border-radius:16px 16px 0 0;position:fixed;bottom:0;left:0;right:0;width:100%!important;max-width:100%!important}
  .prev-ov{align-items:flex-end}
  .topbar-l .ttl{font-size:17px}
  .topbar-l .tsub{display:none}
  .welcome-banner{flex-direction:column}
  .cd-band{flex-direction:column;gap:10px}
  .hbtns{flex-direction:column}
  .hsa-hero{padding:24px 16px}
  .sf-inner{display:flex!important;flex-direction:column!important}
  .sf-col{width:100%!important;padding:16px 0!important;border:none!important;display:block!important;text-align:center!important}
  .sf-col:first-child{text-align:center!important}
  .sf-bottom{flex-direction:column;align-items:flex-start;gap:4px}
}

/* â•â•â• GLOBAL UI ENHANCEMENTS â•â•â• */

/* Smooth page entry */
body{animation:pageLoad .4s cubic-bezier(.2,.8,.3,1)}
@keyframes pageLoad{from{opacity:0}to{opacity:1}}

/* Card hover lift */
.card{transition:all .25s cubic-bezier(.2,.8,.3,1)!important}
.card:hover{border-color:rgba(0,229,255,.25)!important;transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,.3)!important}

/* Stat cards glow on hover */
.stat-c:hover{border-color:var(--accent)!important;box-shadow:0 0 20px rgba(0,229,255,.1)!important}

/* Nav items smooth */
.nav-a{transition:all .18s cubic-bezier(.2,.8,.3,1)!important}

/* Logo pulse */
@keyframes logoPulse{0%,100%{box-shadow:0 0 16px rgba(0,229,255,.3)}50%{box-shadow:0 0 28px rgba(0,229,255,.5)}}
.logo-icon{animation:logoPulse 3s ease-in-out infinite}

/* Topbar shadow on scroll */
.topbar{transition:box-shadow .3s,background .3s,border-color .3s,left .28s!important}
.topbar.scrolled{box-shadow:0 4px 32px rgba(0,0,0,.3)!important}

/* Buttons ripple */
.btn{position:relative;overflow:hidden}
.btn::after{content:'';position:absolute;inset:0;background:rgba(255,255,255,.1);opacity:0;border-radius:inherit;transform:scale(0);transition:.3s}
.btn:active::after{transform:scale(1);opacity:1;transition:0s}

/* Progress bars animated on load */
.pbar-fill{animation:growBar .9s cubic-bezier(.2,.8,.3,1) both}
@keyframes growBar{from{width:0!important}to{}}

/* Suggestion items slide */
.sug-item{transition:all .18s cubic-bezier(.2,.8,.3,1)!important}
.sug-item:hover{transform:translateX(5px)!important;background:rgba(0,229,255,.03)!important}

/* Topic cards */
.tc{transition:all .2s cubic-bezier(.2,.8,.3,1)!important}
.tc:hover{transform:translateY(-4px)!important;box-shadow:0 12px 32px rgba(0,0,0,.3)!important}

/* Mode cards */
.mode-c{transition:all .2s cubic-bezier(.2,.8,.3,1)!important}
.mode-c:hover{transform:translateY(-3px)!important;box-shadow:0 8px 24px rgba(0,0,0,.25)!important}

/* Part cards HSA */
.part-c{transition:all .2s cubic-bezier(.2,.8,.3,1)!important}
.part-c:hover{transform:translateY(-4px)!important;box-shadow:0 12px 32px rgba(0,0,0,.3)!important}

/* Scrollbar upgrade */
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:rgba(0,229,255,.2);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:rgba(0,229,255,.4)}

/* Selection color */
::selection{background:rgba(0,229,255,.25);color:var(--text)}

/* Footer members hover */
.sf-member{transition:.2s}
.sf-member:hover{color:var(--accent)!important;transform:translateX(4px)}

/* Icon buttons */
.icon-btn{transition:all .18s cubic-bezier(.2,.8,.3,1)!important}
.icon-btn:hover{transform:translateY(-1px)!important;background:rgba(0,229,255,.08)!important}

/* Leaderboard items */
.lb-item{transition:.18s}
.lb-item:hover{background:rgba(0,229,255,.04);border-radius:8px;padding-left:8px}

/* Schedule items */
.sched-item{transition:.18s}
.sched-item:hover{background:rgba(0,229,255,.03);border-radius:10px;padding:12px 8px}

/* Badge pop */
.badge{animation:badgePop 2s ease-in-out infinite}
@keyframes badgePop{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

/* HSA Hero gradient animate */
.hsa-hero{background:linear-gradient(135deg,rgba(124,58,237,.08),rgba(0,229,255,.04),rgba(245,158,11,.04))!important;background-size:200%!important;animation:heroGrad 6s ease-in-out infinite!important}
@keyframes heroGrad{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

/* Streak flame */
.streak-flame,.streak-icon{animation:flameDance 2s ease-in-out infinite}
@keyframes flameDance{0%,100%{transform:rotate(-4deg) scale(1)}25%{transform:rotate(4deg) scale(1.07)}50%{transform:rotate(-2deg) scale(1.04)}75%{transform:rotate(3deg) scale(1.06)}}

/* Count-up animation for stats */
.stat-val,.sh-sv,.srv{animation:countUp .6s cubic-bezier(.2,.8,.3,1) both}
@keyframes countUp{from{opacity:0;transform:scale(.7) translateY(10px)}to{opacity:1;transform:none}}
</style>
</head>
<body>
<div class="app">
<div class="sidebar-overlay" id="sb-overlay" onclick="closeSidebar()"></div>

<aside class="sidebar">
  <button class="sidebar-close" onclick="closeSidebar()">â€¹</button>
  <a class="logo" href="dashboard.html">
    <div class="logo-icon"><img src="logo.png" style="width:28px;height:28px;object-fit:contain;"></div>
    <div class="logo-text">Luyen<em>Thi</em>369</div>
  </a>
  <nav class="nav">
    <div class="nav-sec">
      <div class="nav-lbl">Tá»•ng quan</div>
      <a class="nav-a " href="dashboard.html"><span class="ic">ğŸ </span>Trang chá»§</a>
    </div>
    <div class="nav-sec">
      <div class="nav-lbl">Luyá»‡n táº­p</div>
      <a class="nav-a " href="luyen-mon.html"><span class="ic">ğŸ“–</span>Luyá»‡n theo mÃ´n</a>
      <a class="nav-a active" href="hsa.html"><span class="ic">ğŸ›ï¸</span>PhÃ²ng luyá»‡n HSA<span class="badge">HOT</span></a>
    </div>
    <div class="nav-sec">
      <div class="nav-lbl">Tra cá»©u</div>
      <a class="nav-a " href="ngan-hang-de.html"><span class="ic">ğŸ—‚ï¸</span>NgÃ¢n hÃ ng Ä‘á»</a>
      <a class="nav-a " href="cai-dat.html"><span class="ic">âš™ï¸</span>CÃ i Ä‘áº·t</a>
    </div>
  </nav>
  <div class="sb-foot">
    <a class="user-card" href="cai-dat.html">
      <div class="av" id="sb-av">?</div>
      <div><div class="uname" id="sb-name">Äang táº£i...</div><div class="uplan">â­ PRO</div></div>
    </a>
    <button class="logout" onclick="location.href='dang-nhap.html'">ğŸšª ÄÄƒng xuáº¥t</button>
  </div>
</aside>

<div class="main">
  <div class="topbar">
    <div class="topbar-l" style="display:flex;align-items:center;gap:10px"><button class="hamburger" onclick="openSidebar()">â˜°</button><div style="display:flex;flex-direction:column"><div class="ttl">PhÃ²ng luyá»‡n HSA</div><div class="tsub">ÄÃ¡nh giÃ¡ nÄƒng lá»±c â€“ ÄH Quá»‘c gia HÃ  Ná»™i</div></div></div>
    <div class="topbar-r">
      <button class="icon-btn" onclick="Pomodoro.open()" title="Pomodoro">ğŸ…</button>
      <button class="btn btn-v" onclick="Battle.open()" style="gap:6px">âš”ï¸ Battle</button>
      <button class="icon-btn" id="theme-btn" onclick="toggleTheme()">â˜€ï¸</button>
    </div>
  </div>
  <div class="content fadein">
    <div class="hsa-hero">
      <div class="hbadge">ğŸ›ï¸ Äáº I Há»ŒC QUá»C GIA HÃ€ Ná»˜I</div>
      <h2>PhÃ²ng Luyá»‡n Thi HSA</h2>
      <p>BÃ i thi ÄÃ¡nh giÃ¡ nÄƒng lá»±c Â· 150 cÃ¢u Â· 195 phÃºt Â· 3 pháº§n thi</p>
      <div class="hbtns">
        <button class="btn btn-v" style="font-size:14px;padding:12px 28px" onclick="openExam()">ğŸš€ Thi Full Äá»</button>
        <button class="btn btn-g" style="font-size:14px;padding:12px 28px">ğŸ“… Xem lá»‹ch thi thá»­</button>
      </div>
    </div>
    <div class="stats-row">
      <div class="src"><div class="srv" style="color:var(--accent2)">118</div><div class="srl">Äiá»ƒm thi cao nháº¥t</div></div>
      <div class="src"><div class="srv" style="color:var(--accent)">11</div><div class="srl">Láº§n Ä‘Ã£ thi</div></div>
      <div class="src"><div class="srv" style="color:var(--green)">72%</div><div class="srl">Tá»‰ lá»‡ cÃ¢u Ä‘Ãºng</div></div>
      <div class="src"><div class="srv" style="color:var(--accent3)">#4</div><div class="srl">Xáº¿p háº¡ng tuáº§n</div></div>
    </div>
    <div class="parts-grid">
      <div class="part-c" onclick="openExam('dinh-luong')"><div class="pc-ic">ğŸ”¢</div><div class="pc-t">TÆ° duy Ä‘á»‹nh lÆ°á»£ng</div><div class="pc-s">ToÃ¡n há»c &amp; suy luáº­n sá»‘ há»c</div><div class="pc-meta"><span class="chip">50 cÃ¢u</span><span class="chip">75 phÃºt</span><span class="chip">KhÃ³</span></div></div>
      <div class="part-c" onclick="openExam('dinh-tinh')"><div class="pc-ic">ğŸ“</div><div class="pc-t">TÆ° duy Ä‘á»‹nh tÃ­nh</div><div class="pc-s">Äá»c hiá»ƒu &amp; NgÃ´n ngá»¯</div><div class="pc-meta"><span class="chip">50 cÃ¢u</span><span class="chip">60 phÃºt</span><span class="chip">Trung bÃ¬nh</span></div></div>
      <div class="part-c" onclick="openExam('khoa-hoc')"><div class="pc-ic">ğŸ”¬</div><div class="pc-t">Khoa há»c</div><div class="pc-s">LÃ½ Â· HÃ³a Â· Sinh Â· Äá»‹a Â· Sá»­</div><div class="pc-meta"><span class="chip">50 cÃ¢u</span><span class="chip">60 phÃºt</span><span class="chip">KhÃ³</span></div></div>
    </div>
    <div class="two-col">
      <div class="card">
        <div class="card-title">ğŸ† Báº£ng xáº¿p háº¡ng tuáº§n nÃ y</div>
        <div class="lb-item"><span class="lbr" style="color:#f59e0b">ğŸ¥‡</span><div class="lbn">Tráº§n Minh QuÃ¢n</div><div class="lbs">127.5</div></div>
        <div class="lb-item"><span class="lbr" style="color:#9ca3af">ğŸ¥ˆ</span><div class="lbn">LÃª Thá»‹ Hoa</div><div class="lbs">124.0</div></div>
        <div class="lb-item"><span class="lbr" style="color:#b45309">ğŸ¥‰</span><div class="lbn">Pháº¡m Äá»©c Long</div><div class="lbs">122.5</div></div>
        <div class="lb-item"><span class="lbr" style="color:var(--accent3)">4</span><div class="lbn" id="lb-me">Báº¡n</div><div class="lbs me">118.0</div></div>
        <div class="lb-item"><span class="lbr">5</span><div class="lbn">VÅ© Thanh Háº±ng</div><div class="lbs">115.5</div></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“… Lá»‹ch thi thá»­ sáº¯p tá»›i</div>
        <div class="sched-item"><div class="sic" style="background:rgba(124,58,237,.1)">ğŸ“‹</div><div><div class="stt">Mock Test #12</div><div class="sts">Thá»© 7 Â· 07/03/2026 Â· 8:00 AM</div></div><button class="reg-btn" onclick="this.textContent='âœ… ÄÃ£ Ä‘Äƒng kÃ½';this.classList.add('done')">ÄÄƒng kÃ½</button></div>
        <div class="sched-item"><div class="sic" style="background:rgba(0,229,255,.1)">ğŸ“‹</div><div><div class="stt">Mock Test #13</div><div class="sts">Thá»© 7 Â· 14/03/2026 Â· 8:00 AM</div></div><button class="reg-btn" onclick="this.textContent='âœ… ÄÃ£ Ä‘Äƒng kÃ½';this.classList.add('done')">ÄÄƒng kÃ½</button></div>
        <div class="sched-item"><div class="sic" style="background:rgba(16,185,129,.1)">ğŸ“‹</div><div><div class="stt">Mock Test #14</div><div class="sts">Thá»© 7 Â· 21/03/2026 Â· 8:00 AM</div></div><button class="reg-btn" onclick="this.textContent='âœ… ÄÃ£ Ä‘Äƒng kÃ½';this.classList.add('done')">ÄÄƒng kÃ½</button></div>
        <div class="sched-item"><div class="sic" style="background:rgba(245,158,11,.1)">ğŸ“‹</div><div><div class="stt">Mock Test #15 (Final)</div><div class="sts">Thá»© 7 Â· 28/03/2026 Â· 8:00 AM</div></div><button class="reg-btn" onclick="this.textContent='âœ… ÄÃ£ Ä‘Äƒng kÃ½';this.classList.add('done')">ÄÄƒng kÃ½</button></div>
      </div>
    </div>
  </div>
  
<footer class="site-footer">
  <div class="sf-inner">
    <div class="sf-col">
      <div class="sf-label">Äá»‹a chá»‰</div>
      <div class="sf-addr">
        <strong>Lá»›p 12A4</strong><br>
        TrÆ°á»ng THPT Äan PhÆ°á»£ng<br>
        Thá»‹ tráº¥n PhÃ¹ng, huyá»‡n Äan PhÆ°á»£ng<br>
        HÃ  Ná»™i
      </div>
      <div class="sf-map">
        <iframe src="https://maps.google.com/maps?q=Tr%C6%B0%E1%BB%9Dng%20THPT%20%C4%90an%20Ph%C6%B0%E1%BB%A3ng&t=&z=15&ie=UTF8&iwloc=&output=embed" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>
    <div class="sf-col">
      <div class="sf-label">ThÃ nh viÃªn nhÃ³m</div>
      <div class="sf-members">
        <div class="sf-member">Nguyá»…n Tháº¿ Háº£i Nam</div>
        <div class="sf-member">DoÃ£n HÃ  Anh</div>
        <div class="sf-member">Nguyá»…n Huyá»n Linh</div>
        <div class="sf-member">Äá»— Minh PhÆ°Æ¡ng</div>
        <div class="sf-member">Nguyá»…n Thá»‹ Mai Trang</div>
      </div>
    </div>
    <div class="sf-col">
      <div class="sf-label">Máº¡ng xÃ£ há»™i</div>
      <div class="sf-fb">
        <a href="https://facebook.com" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#1877f2"><path d="M24 12.073C24 5.405 18.627 0 12 0S0 5.405 0 12.073C0 18.1 4.388 23.094 10.125 24v-8.437H7.078v-3.49h3.047V9.413c0-3.025 1.792-4.697 4.533-4.697 1.312 0 2.686.235 2.686.235v2.953h-1.513c-1.491 0-1.956.93-1.956 1.886v2.284h3.328l-.532 3.49h-2.796V24C19.612 23.094 24 18.1 24 12.073z"/></svg>
          Facebook
        </a>
      </div>
    </div>
  </div>
  <div class="sf-bottom">
    <span class="sf-copy">Â© 2026 LuyenThi369</span>
    <span class="sf-brand">Lá»›p 12A4 Â· TrÆ°á»ng THPT Äan PhÆ°á»£ng</span>
  </div>
</footer>

</div>
</div>
<!-- EXAM OVERLAY -->
<div class="exam-ov" id="exam-ov">
  <div class="exam-box">
    <div class="exam-hdr">
      <div class="exam-title">ğŸ›ï¸ HSA Full Exam â€“ Äá» sá»‘ 12</div>
      <div class="exam-timer" id="exam-timer">03:15:00</div>
      <div class="exam-close" onclick="closeExam()">âœ•</div>
    </div>
    <div class="exam-body">
      <div class="exam-parts">
        <div class="ep-title">Pháº§n thi</div>
        <div class="ep-part active" onclick="switchPart(this,'dinh-luong')"><div class="ep-name">ğŸ”¢ TÆ° duy Ä‘á»‹nh lÆ°á»£ng</div><div class="ep-sub">CÃ¢u 1â€“50 Â· 75 phÃºt</div></div>
        <div class="ep-part" onclick="switchPart(this,'dinh-tinh')"><div class="ep-name">ğŸ“ TÆ° duy Ä‘á»‹nh tÃ­nh</div><div class="ep-sub">CÃ¢u 51â€“100 Â· 60 phÃºt</div></div>
        <div class="ep-part" onclick="switchPart(this,'khoa-hoc')"><div class="ep-name">ğŸ”¬ Khoa há»c</div><div class="ep-sub">CÃ¢u 101â€“150 Â· 60 phÃºt</div></div>
        <div style="margin-top:20px;padding:12px;background:rgba(124,58,237,.08);border-radius:10px;border:1px solid rgba(124,58,237,.2)">
          <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-weight:600;text-transform:uppercase;letter-spacing:1px">Tiáº¿n Ä‘á»™</div>
          <div id="ep-prog" style="font-size:15px;font-weight:800;color:var(--accent2);font-family:'Space Mono'">0 / 150</div>
          <div class="pbar" style="margin-top:6px"><div class="pbar-fill" id="ep-prog-fill" style="width:0%;background:var(--accent2)"></div></div>
        </div>
      </div>
      <div class="exam-qs" id="exam-qs"></div>
    </div>
    <div class="exam-foot" id="exam-foot">
      <div id="ans-count" style="font-size:13px;color:var(--muted)">ÄÃ£ tráº£ lá»i: <strong>0</strong> / 150 cÃ¢u</div>
      <div style="display:flex;gap:10px">
        <button class="btn btn-g" onclick="closeExam()">LÆ°u &amp; ThoÃ¡t</button>
        <button class="btn btn-v" onclick="submitExam()">Ná»™p bÃ i âœ“</button>
      </div>
    </div>
  </div>
</div>
<script>

function applyTheme(t){
  document.documentElement.setAttribute('data-theme',t);
  localStorage.setItem('lt369_theme',t);
  const b=document.getElementById('theme-btn');
  if(b) b.textContent=t==='dark'?'â˜€ï¸':'ğŸŒ™';
}
function toggleTheme(){applyTheme(document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark')}


(function(){
  applyTheme(localStorage.getItem('lt369_theme')||'dark');
  const n=localStorage.getItem('lt369_user')||'báº¡n';
  const av=document.getElementById('sb-av');
  const nm=document.getElementById('sb-name');
  if(av) av.textContent=n.charAt(0).toUpperCase();
  if(nm) nm.textContent=n;
  const el=document.getElementById('na-hsa');
  if(el) el.classList.add('active');
})();

(function(){
  const n=localStorage.getItem('lt369_user')||'báº¡n';
  document.getElementById('lb-me').textContent=n+' (báº¡n)';
})();
const SAMPLE_QS={
  'dinh-luong':[
    {t:'Cho dÃ£y sá»‘: 2, 5, 10, 17, 26, ... Sá»‘ háº¡ng tiáº¿p theo lÃ  bao nhiÃªu?',o:['35','36','37','38'],a:2},
    {t:'Má»™t cá»­a hÃ ng giáº£m 20% rá»“i láº¡i giáº£m 10%. Tá»•ng má»©c giáº£m lÃ  bao nhiÃªu %?',o:['28%','29%','30%','25%'],a:0},
    {t:'Tá»•ng cÃ¡c sá»‘ tá»« 1 Ä‘áº¿n 50 báº±ng:',o:['1225','1275','1250','1300'],a:1},
    {t:'Náº¿u xÂ² = 16, thÃ¬ |x| báº±ng:',o:['2','4','8','16'],a:1},
    {t:'Trung bÃ¬nh cá»™ng cá»§a 4, 8, 12, 16 lÃ :',o:['8','10','11','12'],a:1},
  ],
  'dinh-tinh':[
    {t:'"ThÃ nh cÃ´ng khÃ´ng pháº£i chÃ¬a khÃ³a háº¡nh phÃºc. Háº¡nh phÃºc má»›i lÃ  chÃ¬a khÃ³a thÃ nh cÃ´ng." Ã chÃ­nh lÃ ?',o:['Háº¡nh phÃºc quan trá»ng hÆ¡n thÃ nh cÃ´ng','ThÃ nh cÃ´ng quan trá»ng hÆ¡n','Cáº£ hai báº±ng nhau','KhÃ´ng cÃ¡i nÃ o'],a:0},
    {t:'Tá»« nÃ o sau Ä‘Ã¢y cÃ³ nghÄ©a trÃ¡i vá»›i "kiÃªn nháº«n"?',o:['bÃ¬nh tÄ©nh','nÃ³ng vá»™i','cáº©n tháº­n','chá»‹u Ä‘á»±ng'],a:1},
    {t:'CÃ¢u tá»¥c ngá»¯ "Há»c tháº§y khÃ´ng tÃ y há»c báº¡n" Ã½ nghÄ©a lÃ ?',o:['Tháº§y khÃ´ng giá»i báº±ng báº¡n','Há»c báº¡n bÃ¨ cÅ©ng ráº¥t quan trá»ng','KhÃ´ng cáº§n tháº§y giÃ¡o','Báº¡n bÃ¨ giá»i hÆ¡n tháº§y'],a:1},
  ],
  'khoa-hoc':[
    {t:'ÄÆ¡n vá»‹ Ä‘o lá»±c trong há»‡ SI lÃ ?',o:['Pascal','Joule','Newton','Watt'],a:2},
    {t:'NguyÃªn tá»‘ cÃ³ kÃ½ hiá»‡u hÃ³a há»c "Fe" lÃ ?',o:['Fluor','Sáº¯t','Thiáº¿c','Flo'],a:1},
    {t:'ADN cÃ³ cáº¥u trÃºc hÃ¬nh gÃ¬?',o:['Chuá»—i tháº³ng','VÃ²ng trÃ²n','Xoáº¯n kÃ©p','HÃ¬nh cáº§u'],a:2},
    {t:'Quang há»£p xáº£y ra á»Ÿ bÃ o quan nÃ o?',o:['Ty thá»ƒ','Lá»¥c láº¡p','Ribosome','NhÃ¢n'],a:1},
  ]
};
let examAnswers={},examTimer=null,examSeconds=11700;
function openExam(part){document.getElementById('exam-ov').classList.add('show');document.body.style.overflow='hidden';if(part){const el=document.querySelector('.ep-part');if(el)switchPart(el,part)}else renderExamPart('dinh-luong');startExamTimer()}
function closeExam(){document.getElementById('exam-ov').classList.remove('show');document.body.style.overflow='';clearInterval(examTimer)}
function switchPart(el,part){if(el){document.querySelectorAll('.ep-part').forEach(e=>e.classList.remove('active'));el.classList.add('active')}renderExamPart(part)}
function renderExamPart(part){
  const qs=SAMPLE_QS[part]||[];
  const offset=part==='dinh-luong'?0:part==='dinh-tinh'?50:100;
  document.getElementById('exam-qs').innerHTML=qs.map((q,i)=>`
    <div class="exam-q">
      <div class="eq-num">CÃ¢u ${offset+i+1}</div>
      <div class="eq-text">${q.t}</div>
      <div class="eq-opts">${q.o.map((o,j)=>`
        <div class="eq-opt ${examAnswers[offset+i]===j?'picked':''}" onclick="pickAns(${offset+i},${j},this)">
          <span class="eq-lbl">${['A','B','C','D'][j]}</span>${o}
        </div>`).join('')}</div>
    </div>`).join('')+`<div style="padding:20px;text-align:center;color:var(--muted);font-size:13px;font-style:italic">... Demo ${qs.length} cÃ¢u máº«u / 50 cÃ¢u thá»±c táº¿</div>`;
}
function pickAns(qi,ai,el){
  examAnswers[qi]=ai;
  el.closest('.eq-opts').querySelectorAll('.eq-opt').forEach(e=>e.classList.remove('picked'));
  el.classList.add('picked');
  const cnt=Object.keys(examAnswers).length;
  document.getElementById('ans-count').innerHTML=`ÄÃ£ tráº£ lá»i: <strong>${cnt}</strong> / 150 cÃ¢u`;
  document.getElementById('ep-prog').textContent=cnt+' / 150';
  document.getElementById('ep-prog-fill').style.width=(cnt/150*100)+'%';
}
function startExamTimer(){clearInterval(examTimer);examSeconds=11700;examTimer=setInterval(()=>{examSeconds--;const h=Math.floor(examSeconds/3600),m=Math.floor((examSeconds%3600)/60),s=examSeconds%60;document.getElementById('exam-timer').textContent=String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');if(examSeconds<=0){clearInterval(examTimer);submitExam()}if(examSeconds<=300)document.getElementById('exam-timer').style.color='var(--red)'},1000)}
function submitExam(){
  clearInterval(examTimer);
  const cnt=Object.keys(examAnswers).length,score=Math.floor(70+Math.random()*50);
  document.getElementById('exam-qs').innerHTML=`<div style="text-align:center;padding:48px 20px"><div style="font-size:56px;margin-bottom:12px">ğŸ¯</div><div style="font-size:48px;font-weight:900;font-family:'Space Mono';color:var(--accent2);margin-bottom:8px">${score}</div><div style="font-size:18px;font-weight:700;margin-bottom:6px">${score>=100?'ğŸ† Xuáº¥t sáº¯c!':score>=80?'â­ Tá»‘t láº¯m!':'ğŸ“ˆ Tiáº¿p tá»¥c cá»‘ gáº¯ng!'}</div><div style="font-size:13px;color:var(--muted);margin-bottom:28px">ÄÃ£ tráº£ lá»i ${cnt} / 150 cÃ¢u</div><button class="btn btn-v" onclick="closeExam()">âœ“ HoÃ n táº¥t</button></div>`;
  document.getElementById('exam-foot').style.display='none';
}


// Topbar scroll shadow
window.addEventListener('scroll',()=>{
  const tb=document.querySelector('.topbar');
  if(tb) tb.classList.toggle('scrolled',window.scrollY>10);
});
function openSidebar(){
  document.querySelector('.sidebar').classList.add('open');
  var ov=document.getElementById('sb-overlay');
  if(ov)ov.classList.add('show');
  document.body.style.overflow='hidden';
}
function closeSidebar(){
  document.querySelector('.sidebar').classList.remove('open');
  var ov=document.getElementById('sb-overlay');
  if(ov)ov.classList.remove('show');
  document.body.style.overflow='';
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED ENHANCEMENTS - LuyenThi369
// Battle Mode + Sound + Confetti + UI upgrades
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ WEB AUDIO SOUND ENGINE â”€â”€
const SFX = (function(){
  let ctx = null;
  function getCtx(){ if(!ctx) ctx = new (window.AudioContext||window.webkitAudioContext)(); return ctx; }
  function play(freq, type, duration, gain=0.3){
    try{
      const c=getCtx(), o=c.createOscillator(), g=c.createGain();
      o.connect(g); g.connect(c.destination);
      o.type=type; o.frequency.setValueAtTime(freq,c.currentTime);
      g.gain.setValueAtTime(gain,c.currentTime);
      g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+duration);
      o.start(c.currentTime); o.stop(c.currentTime+duration);
    } catch(e){}
  }
  return {
    correct(){ play(523,  'sine', 0.12, 0.25); setTimeout(()=>play(659,'sine',0.12,0.2),80); setTimeout(()=>play(784,'sine',0.18,0.18),160); },
    wrong(){   play(200,  'sawtooth', 0.15, 0.18); setTimeout(()=>play(160,'sawtooth',0.1,0.18),100); },
    flip(){    play(880,  'sine', 0.06, 0.08); },
    click(){   play(1200, 'sine', 0.04, 0.05); },
    streak(){  [523,659,784,1047].forEach((f,i)=>setTimeout(()=>play(f,'sine',0.2,0.3),i*80)); },
    countdown(){ play(440,'square',0.1,0.08); },
    finish(){  [784,988,1175,1568].forEach((f,i)=>setTimeout(()=>play(f,'sine',0.25,0.3),i*100)); },
    battle_start(){ [262,330,392,523].forEach((f,i)=>setTimeout(()=>play(f,'triangle',0.2,0.25),i*60)); }
  };
})();

// â”€â”€ CONFETTI ENGINE â”€â”€
const Confetti = (function(){
  let canvas, ctx2, pieces=[], anim=null;
  const COLORS=['#00e5ff','#7c3aed','#f59e0b','#10b981','#ef4444','#a78bfa','#34d399','#fbbf24'];
  function init(){
    if(canvas) return;
    canvas=document.createElement('canvas');
    canvas.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:99999;';
    document.body.appendChild(canvas);
    ctx2=canvas.getContext('2d');
    resize(); window.addEventListener('resize',resize);
  }
  function resize(){ if(canvas){canvas.width=innerWidth;canvas.height=innerHeight;} }
  function burst(n=120){
    init();
    for(let i=0;i<n;i++){
      pieces.push({
        x:Math.random()*innerWidth, y:-20,
        vx:(Math.random()-0.5)*8, vy:Math.random()*6+3,
        rot:Math.random()*360, rotV:(Math.random()-0.5)*8,
        w:Math.random()*10+5, h:Math.random()*6+3,
        color:COLORS[Math.floor(Math.random()*COLORS.length)],
        alpha:1, gravity:0.15
      });
    }
    if(!anim) loop();
  }
  function loop(){
    ctx2.clearRect(0,0,canvas.width,canvas.height);
    pieces=pieces.filter(p=>{
      p.x+=p.vx; p.y+=p.vy; p.vy+=p.gravity;
      p.rot+=p.rotV; p.alpha-=0.008;
      if(p.alpha<=0||p.y>canvas.height+20) return false;
      ctx2.save(); ctx2.translate(p.x,p.y); ctx2.rotate(p.rot*Math.PI/180);
      ctx2.globalAlpha=p.alpha; ctx2.fillStyle=p.color;
      ctx2.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx2.restore();
      return true;
    });
    if(pieces.length>0){anim=requestAnimationFrame(loop);}
    else{anim=null; ctx2.clearRect(0,0,canvas.width,canvas.height);}
  }
  return { burst };
})();

// â”€â”€ TOAST SYSTEM â”€â”€
function showToast(ic, title, sub, color=''){
  let t=document.getElementById('global-toast');
  if(!t){
    t=document.createElement('div'); t.id='global-toast';
    t.style.cssText='position:fixed;bottom:24px;right:24px;background:linear-gradient(135deg,#1a2236,#0d1220);border:1px solid #1e2840;border-radius:14px;padding:14px 20px;display:flex;align-items:center;gap:12px;z-index:9998;transform:translateY(80px);opacity:0;transition:.4s cubic-bezier(.2,.8,.3,1);box-shadow:0 8px 32px rgba(0,0,0,.5);max-width:300px;pointer-events:none;';
    document.body.appendChild(t);
  }
  if(color) t.style.borderColor=color;
  t.innerHTML=`<span style="font-size:24px">${ic}</span><div><div style="font-size:14px;font-weight:700;color:#e8edf5">${title}</div>${sub?`<div style="font-size:12px;color:#5a6b88;margin-top:2px">${sub}</div>`:''}</div>`;
  t.style.transform='translateY(0)'; t.style.opacity='1';
  clearTimeout(t._timer);
  t._timer=setTimeout(()=>{t.style.transform='translateY(80px)';t.style.opacity='0';},3500);
}

// â”€â”€ BATTLE MODE â”€â”€
const Battle = (function(){
  const QBANK_BATTLE = {
    toan:[
      {q:'âˆ«2x dx = ?',o:['xÂ²+C','xÂ²/2+C','2xÂ²+C','2+C'],a:0},
      {q:'Äáº¡o hÃ m cá»§a xÂ³ lÃ ?',o:['3x','3xÂ²','xÂ²','2xÂ³'],a:1},
      {q:'logâ‚‚(8) = ?',o:['2','3','4','8'],a:1},
      {q:'sin(90Â°) = ?',o:['0','1','-1','âˆš2/2'],a:1},
      {q:'Diá»‡n tÃ­ch hÃ¬nh trÃ²n bÃ¡n kÃ­nh r?',o:['Ï€r','2Ï€r','Ï€rÂ²','4Ï€rÂ²'],a:2},
      {q:'(a+b)Â² = ?',o:['aÂ²+bÂ²','aÂ²+ab+bÂ²','aÂ²+2ab+bÂ²','2aÂ²+2bÂ²'],a:2},
      {q:'Nghiá»‡m cá»§a 2x+6=0 lÃ ?',o:['x=3','x=-3','x=6','x=-6'],a:1},
      {q:'C(5,2) = ?',o:['10','20','5','15'],a:0},
      {q:'cos(0Â°) = ?',o:['0','1','-1','1/2'],a:1},
      {q:'Giá»›i háº¡n lim(xâ†’âˆ) 1/x = ?',o:['1','âˆ','0','-1'],a:2},
    ],
    ly:[
      {q:'F=ma. Náº¿u F=10N, m=2kg thÃ¬ a=?',o:['5 m/sÂ²','20 m/sÂ²','8 m/sÂ²','12 m/sÂ²'],a:0},
      {q:'Tá»‘c Ä‘á»™ Ã¡nh sÃ¡ng xáº¥p xá»‰?',o:['3Ã—10â¶ m/s','3Ã—10â¸ m/s','3Ã—10Â¹â° m/s','3Ã—10â´ m/s'],a:1},
      {q:'ÄÆ¡n vá»‹ Ä‘o lá»±c lÃ ?',o:['Pascal','Joule','Newton','Watt'],a:2},
      {q:'CÃ´ng thá»©c tÃ­nh Ä‘á»™ng nÄƒng?',o:['mv','Â½mvÂ²','ma','FÃ—d'],a:1},
      {q:'P=UÃ—I lÃ  cÃ´ng thá»©c tÃ­nh?',o:['Äiá»‡n trá»Ÿ','CÃ´ng suáº¥t','Äiá»‡n Ã¡p','CÆ°á»ng Ä‘á»™'],a:1},
      {q:'Chu ká»³ T = 1/f, f lÃ ?',o:['BiÃªn Ä‘á»™','Pha ban Ä‘áº§u','Táº§n sá»‘','GÃ³c pha'],a:2},
      {q:'Hiá»‡n tÆ°á»£ng khÃºc xáº¡ Ã¡nh sÃ¡ng xáº£y ra khi?',o:['Ãnh sÃ¡ng pháº£n xáº¡','Ãnh sÃ¡ng Ä‘i qua 2 mÃ´i trÆ°á»ng','Ãnh sÃ¡ng táº¯t','Nhiá»…u xáº¡'],a:1},
      {q:'ÄÆ¡n vá»‹ Ä‘iá»‡n trá»Ÿ lÃ ?',o:['Volt','Ampere','Ohm','Farad'],a:2},
    ],
    hoa:[
      {q:'Sá»‘ hiá»‡u nguyÃªn tá»­ cá»§a Natri (Na)?',o:['10','11','12','13'],a:1},
      {q:'CÃ´ng thá»©c hÃ³a há»c cá»§a nÆ°á»›c?',o:['Hâ‚‚Oâ‚‚','HO','Hâ‚‚O','Hâ‚ƒO'],a:2},
      {q:'NaOH lÃ ?',o:['Axit','BazÆ¡','Muá»‘i','Oxit axit'],a:1},
      {q:'Pháº£n á»©ng trÃ¡ng báº¡c dÃ¹ng Ä‘á»ƒ nháº­n biáº¿t?',o:['Glucozo','Fructozo','Saccarozo','Tinh bá»™t'],a:0},
      {q:'COâ‚‚ lÃ  oxit gÃ¬?',o:['Oxit bazÆ¡','Oxit lÆ°á»¡ng tÃ­nh','Oxit axit','Oxit trung tÃ­nh'],a:2},
      {q:'KhÃ­ gÃ¢y hiá»‡u á»©ng nhÃ  kÃ­nh chá»§ yáº¿u?',o:['Oâ‚‚','Nâ‚‚','COâ‚‚','Hâ‚‚'],a:2},
      {q:'Polyme Ä‘Æ°á»£c tá»•ng há»£p tá»«?',o:['Monome','Dime','Polyme nhá» hÆ¡n','NguyÃªn tá»­'],a:0},
      {q:'Kim loáº¡i nÃ o dáº«n Ä‘iá»‡n tá»‘t nháº¥t?',o:['VÃ ng','Sáº¯t','Báº¡c','NhÃ´m'],a:2},
    ],
    anh:[
      {q:'"She ___ to school every day."',o:['go','goes','going','gone'],a:1},
      {q:'Antonym of "generous"?',o:['kind','stingy','brave','honest'],a:1},
      {q:'"I wish I ___ more money."',o:['have','had','will have','has'],a:1},
      {q:'Passive: "They built this bridge." â†’',o:['This bridge built','This bridge is built','This bridge was built','This bridge were built'],a:2},
      {q:'"Good at" + ?',o:['V-inf','V-ed','V-ing','V-s'],a:2},
      {q:'Which word is a noun?',o:['beautiful','quickly','happiness','run'],a:2},
      {q:'"It is high time we ___."',o:['leave','left','leaving','to leave'],a:1},
      {q:'"Put off" means?',o:['cancel','postpone','hurry','finish'],a:1},
    ],
    mix:[]
  };
  // Build mix from all
  Object.keys(QBANK_BATTLE).filter(k=>k!=='mix').forEach(k=>{
    QBANK_BATTLE.mix.push(...QBANK_BATTLE[k]);
  });

  let overlay, state={};

  function buildOverlay(){
    const el=document.createElement('div');
    el.id='battle-ov';
    el.style.cssText='display:none;position:fixed;inset:0;background:rgba(0,0,0,.92);backdrop-filter:blur(20px);z-index:500;align-items:center;justify-content:center;';
    el.innerHTML=`
    <div id="battle-box" style="width:700px;max-width:95vw;background:#0d1117;border:1px solid #1e2840;border-radius:24px;overflow:hidden;box-shadow:0 40px 100px rgba(0,0,0,.7);">
      <!-- LOBBY -->
      <div id="bt-lobby" style="padding:40px;text-align:center;">
        <div style="font-size:52px;margin-bottom:12px;animation:pulse2 1.5s ease-in-out infinite">âš”ï¸</div>
        <h2 style="font-size:28px;font-weight:900;margin-bottom:8px;background:linear-gradient(135deg,#00e5ff,#7c3aed);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Battle Mode</h2>
        <p style="color:#5a6b88;margin-bottom:28px;font-size:14px">10 cÃ¢u Â· 15 giÃ¢y/cÃ¢u Â· Äiá»ƒm theo tá»‘c Ä‘á»™</p>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:24px;" id="bt-subj-grid">
          <div class="bt-sopt active" data-s="mix" onclick="Battle.selSubj(this,'mix')">ğŸ² Tá»•ng há»£p</div>
          <div class="bt-sopt" data-s="toan" onclick="Battle.selSubj(this,'toan')">ğŸ“ ToÃ¡n</div>
          <div class="bt-sopt" data-s="ly" onclick="Battle.selSubj(this,'ly')">âš¡ Váº­t lÃ½</div>
          <div class="bt-sopt" data-s="hoa" onclick="Battle.selSubj(this,'hoa')">ğŸ§ª HÃ³a</div>
          <div class="bt-sopt" data-s="anh" onclick="Battle.selSubj(this,'anh')">ğŸŒ Anh</div>
        </div>
        <button onclick="Battle.start()" style="width:100%;padding:16px;background:linear-gradient(135deg,#00e5ff,#0099cc);border:none;border-radius:12px;color:#000;font-size:16px;font-weight:800;cursor:pointer;font-family:inherit;transition:.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">âš¡ Báº¯t Ä‘áº§u!</button>
        <button onclick="Battle.close()" style="margin-top:10px;width:100%;padding:10px;background:none;border:1px solid #1e2840;border-radius:12px;color:#5a6b88;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;">âœ• ÄÃ³ng</button>
      </div>
      <!-- GAME -->
      <div id="bt-game" style="display:none;">
        <div style="padding:16px 24px;border-bottom:1px solid #1e2840;display:flex;align-items:center;justify-content:space-between;">
          <div style="font-size:13px;color:#5a6b88;font-weight:600" id="bt-qnum">CÃ¢u 1/10</div>
          <div id="bt-timer-wrap" style="display:flex;align-items:center;gap:8px;">
            <div id="bt-timer-bar-wrap" style="width:120px;height:6px;background:#1e2840;border-radius:999px;overflow:hidden;">
              <div id="bt-timer-bar" style="height:100%;background:linear-gradient(90deg,#00e5ff,#7c3aed);border-radius:999px;transition:width .1s linear;"></div>
            </div>
            <div id="bt-timer" style="font-family:'Space Mono';font-size:20px;font-weight:900;color:#f59e0b;min-width:28px;text-align:right;">15</div>
          </div>
          <div id="bt-score-display" style="font-family:'Space Mono';font-size:16px;font-weight:800;color:#00e5ff;">0 pts</div>
        </div>
        <div style="padding:28px 28px 20px;">
          <div id="bt-qtxt" style="font-size:20px;font-weight:700;line-height:1.6;margin-bottom:22px;min-height:60px;"></div>
          <div id="bt-opts" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;"></div>
          <div id="bt-explain" style="display:none;margin-top:16px;padding:14px 16px;background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.2);border-radius:12px;font-size:13px;line-height:1.7;"></div>
        </div>
      </div>
      <!-- RESULT -->
      <div id="bt-result" style="display:none;padding:40px;text-align:center;"></div>
    </div>`;
    // Add styles
    const style=document.createElement('style');
    style.textContent=`
    #battle-ov.show{display:flex!important}
    .bt-sopt{padding:12px 8px;background:#111622;border:2px solid #1e2840;border-radius:12px;cursor:pointer;font-size:13px;font-weight:700;color:#5a6b88;transition:.2s;text-align:center;}
    .bt-sopt:hover{border-color:#5a6b88;color:#e8edf5;}
    .bt-sopt.active{background:rgba(0,229,255,.08);border-color:#00e5ff;color:#00e5ff;}
    .bt-opt{padding:14px 16px;background:#111622;border:2px solid #1e2840;border-radius:12px;cursor:pointer;font-size:14px;font-weight:600;color:#e8edf5;transition:.2s;text-align:left;display:flex;align-items:center;gap:10px;}
    .bt-opt:hover:not(.locked){border-color:#00e5ff;background:rgba(0,229,255,.04);transform:translateY(-1px);}
    .bt-opt.correct{border-color:#10b981!important;background:rgba(16,185,129,.12)!important;color:#10b981!important;animation:correctPop .3s ease;}
    .bt-opt.wrong{border-color:#ef4444!important;background:rgba(239,68,68,.1)!important;color:#ef4444!important;animation:wrongShake .3s ease;}
    .bt-opt.reveal{border-color:#10b981;background:rgba(16,185,129,.06);color:#10b981;}
    .bt-olbl{width:24px;height:24px;border-radius:6px;background:#1e2840;display:grid;place-items:center;font-size:12px;font-weight:800;flex-shrink:0;font-family:'Space Mono';}
    .bt-opt.correct .bt-olbl{background:#10b981;color:#fff;}
    .bt-opt.wrong .bt-olbl{background:#ef4444;color:#fff;}
    @keyframes pulse2{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    @keyframes correctPop{0%{transform:scale(1)}40%{transform:scale(1.03)}100%{transform:scale(1)}}
    @keyframes wrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-5px)}60%{transform:translateX(5px)}}
    @keyframes btScorePop{0%{transform:scale(1)}50%{transform:scale(1.3)}100%{transform:scale(1)}}
    `;
    document.head.appendChild(style);
    document.body.appendChild(el);
    overlay=el;
  }

  let selectedSubj='mix', timerI=null, timeLeft=15, currentQ=0, questions=[], answers=[], score=0;

  function open(){
    if(!overlay) buildOverlay();
    document.getElementById('bt-lobby').style.display='block';
    document.getElementById('bt-game').style.display='none';
    document.getElementById('bt-result').style.display='none';
    overlay.classList.add('show');
    document.body.style.overflow='hidden';
  }
  function close(){
    if(overlay) overlay.classList.remove('show');
    document.body.style.overflow='';
    clearInterval(timerI);
  }
  function selSubj(el, subj){
    selectedSubj=subj;
    document.querySelectorAll('.bt-sopt').forEach(e=>e.classList.remove('active'));
    el.classList.add('active');
  }
  function start(){
    SFX.battle_start();
    const pool=[...(QBANK_BATTLE[selectedSubj]||QBANK_BATTLE.mix)].sort(()=>Math.random()-.5);
    questions=pool.slice(0,10);
    answers=[];
    score=0;
    currentQ=0;
    document.getElementById('bt-lobby').style.display='none';
    document.getElementById('bt-game').style.display='block';
    document.getElementById('bt-result').style.display='none';
    renderQ();
  }
  function renderQ(){
    if(currentQ>=questions.length){showResult();return;}
    const q=questions[currentQ];
    document.getElementById('bt-qnum').textContent=`CÃ¢u ${currentQ+1}/10`;
    document.getElementById('bt-score-display').textContent=score+' pts';
    document.getElementById('bt-qtxt').textContent=q.q;
    document.getElementById('bt-explain').style.display='none';
    document.getElementById('bt-opts').innerHTML=q.o.map((o,i)=>`
      <div class="bt-opt" onclick="Battle._answer(${i})" data-idx="${i}">
        <span class="bt-olbl">${['A','B','C','D'][i]}</span>${o}
      </div>`).join('');
    startTimer();
  }
  function startTimer(){
    clearInterval(timerI);
    timeLeft=15;
    updateTimerUI();
    timerI=setInterval(()=>{
      timeLeft--;
      updateTimerUI();
      if(timeLeft<=5) SFX.countdown();
      if(timeLeft<=0){clearInterval(timerI);_answer(-1);}
    },1000);
  }
  function updateTimerUI(){
    document.getElementById('bt-timer').textContent=timeLeft;
    document.getElementById('bt-timer-bar').style.width=(timeLeft/15*100)+'%';
    const col=timeLeft<=5?'#ef4444':timeLeft<=10?'#f59e0b':'';
    document.getElementById('bt-timer').style.color=col||'#f59e0b';
    document.getElementById('bt-timer-bar').style.background=timeLeft<=5?'#ef4444':timeLeft<=10?'linear-gradient(90deg,#f59e0b,#ef4444)':'linear-gradient(90deg,#00e5ff,#7c3aed)';
  }
  function _answer(idx){
    clearInterval(timerI);
    const q=questions[currentQ];
    const correct=idx===q.a;
    const timeBonus=Math.max(0,timeLeft);
    const pts=correct?100+timeBonus*10:0;
    score+=pts;
    answers.push({q:q.q,chosen:idx,correct:q.a,isCorrect:correct,pts});
    // Lock all options
    document.querySelectorAll('.bt-opt').forEach(el=>{
      el.classList.add('locked');
      el.style.cursor='default';
      el.onclick=null;
    });
    // Highlight
    document.querySelectorAll('.bt-opt').forEach(el=>{
      const i=parseInt(el.dataset.idx);
      if(i===q.a) el.classList.add('correct');
      else if(i===idx && idx!==q.a) el.classList.add('wrong');
    });
    if(correct){SFX.correct();if(pts>200)Confetti.burst(40);}
    else SFX.wrong();
    document.getElementById('bt-score-display').textContent=score+' pts';
    document.getElementById('bt-score-display').style.animation='btScorePop .3s ease';
    setTimeout(()=>document.getElementById('bt-score-display').style.animation='',300);
    // Show explain briefly then next
    if(idx===-1){
      const exp=document.getElementById('bt-explain');
      exp.innerHTML=`â° <strong>Háº¿t giá»!</strong> ÄÃ¡p Ã¡n Ä‘Ãºng: <strong>${['A','B','C','D'][q.a]}. ${q.o[q.a]}</strong>`;
      exp.style.display='block';
    }
    currentQ++;
    setTimeout(()=>renderQ(), correct?600:1000);
  }
  function showResult(){
    SFX.finish();
    const total=questions.length;
    const correct=answers.filter(a=>a.isCorrect).length;
    const pct=Math.round(correct/total*100);
    if(pct>=80) Confetti.burst(150);
    document.getElementById('bt-game').style.display='none';
    document.getElementById('bt-result').style.display='block';
    const grade=pct>=90?'ğŸ† Huyá»n thoáº¡i!':pct>=70?'â­ Xuáº¥t sáº¯c!':pct>=50?'ğŸ’ª KhÃ¡ tá»‘t!':'ğŸ“– Cáº§n Ã´n thÃªm!';
    const col=pct>=70?'#10b981':pct>=50?'#f59e0b':'#ef4444';
    document.getElementById('bt-result').innerHTML=`
      <div style="font-size:52px;margin-bottom:12px">${pct>=80?'ğŸ†':pct>=60?'â­':'ğŸ’ª'}</div>
      <div style="font-size:56px;font-weight:900;font-family:'Space Mono';color:${col};line-height:1;margin-bottom:4px">${score}</div>
      <div style="font-size:13px;color:#5a6b88;margin-bottom:8px">Ä‘iá»ƒm</div>
      <div style="font-size:18px;font-weight:800;margin-bottom:4px">${grade}</div>
      <div style="font-size:13px;color:#5a6b88;margin-bottom:28px">${correct}/${total} cÃ¢u Ä‘Ãºng</div>
      <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap">
        <button onclick="Battle.start()" style="padding:12px 24px;background:linear-gradient(135deg,#00e5ff,#0099cc);border:none;border-radius:10px;color:#000;font-weight:800;cursor:pointer;font-size:14px;font-family:inherit">ğŸ” ChÆ¡i láº¡i</button>
        <button onclick="Battle.close()" style="padding:12px 24px;background:#111622;border:1px solid #1e2840;border-radius:10px;color:#5a6b88;font-weight:700;cursor:pointer;font-size:14px;font-family:inherit">âœ• ÄÃ³ng</button>
      </div>`;
    // Save high score
    const best=parseInt(localStorage.getItem('lt369_battle_best')||'0');
    if(score>best){
      localStorage.setItem('lt369_battle_best',score);
      showToast('ğŸ†','Ká»· lá»¥c má»›i!',`${score} Ä‘iá»ƒm â€“ Battle Mode`,'#f59e0b');
    }
  }
  return {open,close,start,selSubj,_answer};
})();

// â”€â”€ STREAK MILESTONE CONFETTI â”€â”€
function checkStreakMilestone(){
  const streak=parseInt(localStorage.getItem('lt369_streak')||'0');
  const lastMile=parseInt(localStorage.getItem('lt369_last_milestone')||'0');
  const milestones=[3,7,14,21,30,50,100];
  const hit=milestones.find(m=>streak>=m&&lastMile<m);
  if(hit){
    localStorage.setItem('lt369_last_milestone',hit);
    setTimeout(()=>{
      Confetti.burst(200);
      SFX.streak();
      showToast('ğŸ”¥',`Streak ${hit} ngÃ y!`,hit>=30?'ğŸ† SiÃªu phi thÆ°á»ng!':hit>=14?'ğŸŒŸ Tuyá»‡t vá»i!':'ğŸ’ª Tiáº¿p tá»¥c nhÃ©!','#f59e0b');
    },800);
  }
}

// â”€â”€ POMODORO â”€â”€
const Pomodoro = (function(){
  let overlay, timerI=null, secsLeft=25*60, mode='work', workMins=25;
  function init(){
    if(overlay) return;
    overlay=document.createElement('div');
    overlay.id='pomo-widget';
    overlay.style.cssText='position:fixed;bottom:80px;right:24px;z-index:400;background:#0d1117;border:1px solid #1e2840;border-radius:18px;padding:18px 22px;width:220px;box-shadow:0 12px 40px rgba(0,0,0,.5);display:none;';
    overlay.innerHTML=`
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <div style="font-size:13px;font-weight:700;color:#e8edf5" id="pomo-label">ğŸ… Pomodoro</div>
        <button onclick="Pomodoro.close()" style="background:none;border:none;color:#5a6b88;cursor:pointer;font-size:16px;line-height:1">âœ•</button>
      </div>
      <div style="text-align:center;margin-bottom:14px;">
        <div id="pomo-time" style="font-size:42px;font-weight:900;font-family:'Space Mono';color:#00e5ff;line-height:1;">25:00</div>
        <div id="pomo-mode" style="font-size:11px;color:#5a6b88;margin-top:4px;text-transform:uppercase;letter-spacing:1px;">Táº­p trung</div>
      </div>
      <div style="height:4px;background:#1e2840;border-radius:999px;margin-bottom:14px;overflow:hidden;">
        <div id="pomo-bar" style="height:100%;background:linear-gradient(90deg,#00e5ff,#7c3aed);border-radius:999px;width:100%;transition:width .5s linear;"></div>
      </div>
      <div style="display:flex;gap:8px;">
        <button id="pomo-btn" onclick="Pomodoro.toggle()" style="flex:1;padding:10px;background:linear-gradient(135deg,#00e5ff,#0099cc);border:none;border-radius:10px;color:#000;font-weight:800;cursor:pointer;font-size:13px;font-family:inherit;">â–¶ Báº¯t Ä‘áº§u</button>
        <button onclick="Pomodoro.reset()" style="padding:10px 12px;background:#111622;border:1px solid #1e2840;border-radius:10px;color:#5a6b88;cursor:pointer;font-size:13px;font-family:inherit;">â†º</button>
      </div>`;
    document.body.appendChild(overlay);
  }
  const totalSecs=()=>mode==='work'?workMins*60:5*60;
  function updateUI(){
    const m=Math.floor(secsLeft/60),s=secsLeft%60;
    document.getElementById('pomo-time').textContent=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    document.getElementById('pomo-bar').style.width=(secsLeft/totalSecs()*100)+'%';
    document.getElementById('pomo-mode').textContent=mode==='work'?'Táº­p trung':'Nghá»‰ giáº£i lao';
    const col=mode==='work'?secsLeft<=60?'#ef4444':'#00e5ff':'#10b981';
    document.getElementById('pomo-time').style.color=col;
  }
  function open(){init();overlay.style.display='block';}
  function close(){if(overlay)overlay.style.display='none';clearInterval(timerI);timerI=null;}
  function toggle(){
    if(timerI){clearInterval(timerI);timerI=null;document.getElementById('pomo-btn').textContent='â–¶ Tiáº¿p tá»¥c';}
    else{
      document.getElementById('pomo-btn').textContent='â¸ Dá»«ng';
      timerI=setInterval(()=>{
        secsLeft--;
        updateUI();
        if(secsLeft<=0){
          clearInterval(timerI);timerI=null;
          SFX.finish();
          if(mode==='work'){
            mode='break';secsLeft=5*60;
            showToast('â˜•','Nghá»‰ 5 phÃºt!','Báº¡n Ä‘Ã£ táº­p trung 25 phÃºt, nghá»‰ ngÆ¡i nÃ o!','#10b981');
          } else {
            mode='work';secsLeft=workMins*60;
            showToast('ğŸ…','Báº¯t Ä‘áº§u phiÃªn má»›i!','Táº­p trung 25 phÃºt!','#00e5ff');
          }
          document.getElementById('pomo-btn').textContent='â–¶ Báº¯t Ä‘áº§u';
          updateUI();
        }
      },1000);
    }
  }
  function reset(){clearInterval(timerI);timerI=null;mode='work';secsLeft=workMins*60;document.getElementById('pomo-btn').textContent='â–¶ Báº¯t Ä‘áº§u';updateUI();}
  return {open,close,toggle,reset};
})();


</script>
</body></html>
